# 第十三单元 分类管理及规格参数管理

# 【授课重点】

1. 分类管理
3. 规格参数管理

# 【考核要求】

1. 掌握bootstrap-treeview树型插件使用
2. 能够使用bootstrap进行页面布局
3. 能够独立完成分类管理功能
4. 能够独立完成规格参数管理部分功能

# 【教学内容】

## 13.1 分类管理

### 13.1.1 分类页面

1. 页面原型-category_list.html

   ```
   <!DOCTYPE html>
   <html lang="zh-CN">
   
   	<head>
   		<meta charset="utf-8">
   		<meta http-equiv="X-UA-Compatible" content="IE=edge">
   		<meta name="viewport" content="width=device-width, initial-scale=1">
   		<title></title>
   		<link href="resource/css/bootstrap.css" rel="stylesheet">
   		<link rel="stylesheet" href="resource/css/bootstrap-treeview.css" />
   		<script type="text/javascript" src="resource/jquery/jquery-3.4.1.js"></script>
   	  	<script type="text/javascript" src="resource/bootstrap/js/bootstrap.min.js"></script>
   	  	<script type="text/javascript" src="resource/bootstrap/js/bootstrap-treeview.js" ></script>
   	  	<script type="text/javascript">
   
     	$(function() {
           var defaultData = [
             {
               text: 'Parent 1',
               href: '#parent1',
               tags: ['4'],
               nodes: [
                 {
                   text: 'Child 1',
                   href: '#child1',
                   tags: ['2'],
                   nodes: [
                     {
                       text: 'Grandchild 1',
                       href: '#grandchild1',
                       tags: ['0']
                     },
                     {
                       text: 'Grandchild 2',
                       href: '#grandchild2',
                       tags: ['0']
                     }
                   ]
                 },
                 {
                   text: 'Child 2',
                   href: '#child2',
                   tags: ['0']
                 }
               ]
             },
             {
               text: 'Parent 2',
               href: '#parent2',
               tags: ['0']
             },
             {
               text: 'Parent 3',
               href: '#parent3',
                tags: ['0']
             },
             {
               text: 'Parent 4',
               href: '#parent4',
               tags: ['0']
             },
             {
               text: 'Parent 5',
               href: '#parent5'  ,
               tags: ['0']
             }
           ];
           
   		$("#parentName").click(function() {
   			$('#tree').treeview({
   	          	data: defaultData,
   		        onNodeSelected : function(event, data) {
   					$("#parentId").val(data.id);
   					$("#parentName").val(data.text);
   					$("#tree").hide();//选中树节点后隐藏树
   				}
   	        });	
   	        $('#tree').show();
   		});
   	});
   		</script>
   	</head>
   
   	<body>
   		<div class="container-fluid">
   			<div class="row">
   				<form action="javascript:void(0)" method="post">
   					<div class="form-group">
   						<label for="name">分类名称</label>
   						<input type="text" class="form-control" id="name" placeholder="分类名称">
   					</div>
   					<button type="submit" class="btn btn-success">搜索</button>
   				</form>
   			</div>
   			<div class="row navbar-right">
   				<button type="button" class="btn btn-danger">批量删除</button>
   				<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal">新增分类</button>
   			</div>
   			<div class="row">
   				<table class="table table-striped">
   					<thead>
   						<tr>
   							<th><input type="checkbox" id="cbk" />全选</th>
   							<th>编号</th>
   							<th>分类名称</th>
   							<th>父分类名称</th>
   							<th>操作</th>
   						</tr>
   					</thead>
   					<tbody>
   						<tr>
   							<td><input type="checkbox" class="ck"></td>
   							<td>1</td>
   							<td>Mark</td>
   							<td>Otto</td>
   							<td>
   								<button type="button" class="btn btn-danger">删除</button>
   								<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal2">修改</button>
   								<button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#myModal3">查看</button>
   							</td>
   						</tr>
   					</tbody>
   				</table>
   
   				<nav aria-label="Page navigation">
   					<ul class="pagination">
   						<li>
   							<a href="#" aria-label="Previous">
   								<span aria-hidden="true">上一页</span>
   							</a>
   						</li>
   						<li>
   							<a href="#">1</a>
   						</li>
   						<li>
   							<a href="#">2</a>
   						</li>
   						<li>
   							<a href="#">3</a>
   						</li>
   						<li>
   							<a href="#">4</a>
   						</li>
   						<li>
   							<a href="#">5</a>
   						</li>
   						<li>
   							<a href="#" aria-label="Next">
   								<span aria-hidden="true">下一页</span>
   							</a>
   						</li>
   					</ul>
   				</nav>
   
   			</div>
   		</div>
   
   		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   			<div class="modal-dialog" role="document">
   				<div class="modal-content">
   					<div class="modal-header">
   						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
   						<h4 class="modal-title" id="myModalLabel">新增分类</h4>
   					</div>
   					<div class="modal-body">
   						<form class="form-horizontal">
   						  <div class="form-group">
   						    <label for="name" class="col-sm-3 control-label">分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="name" name="name" placeholder="分类名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <label for="firstChar" class="col-sm-3 control-label">父分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="hidden" class="form-control" id="parentId" name="parentId"> 
   							  <input type="text" class="form-control" id="parentName" placeholder="选择父分类">
   						      <div id="tree" style="display: none; position:absolute; z-index:1010; background-color:white;"></div>
   						    </div>
   						  </div>
   						</form>
   					</div>
   					<div class="modal-footer">
   						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
   						<button type="button" class="btn btn-primary">添加</button>
   					</div>
   				</div>
   			</div>
   		</div>
   		<!-- /.modal -->
   
   
   
   		<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   			<div class="modal-dialog" role="document">
   				<div class="modal-content">
   					<div class="modal-header">
   						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
   						<h4 class="modal-title" id="myModalLabel">编辑分类</h4>
   					</div>
   					<div class="modal-body">
   						<form class="form-horizontal">
   						  <div class="form-group">
   						    <label for="name" class="col-sm-3 control-label">分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="name2" name="name" placeholder="品牌名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <label for="firstChar" class="col-sm-3 control-label">父分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="hidden" class="form-control" id="parentId2" name="parentId"> 
   							  <input type="text" class="form-control" id="parentName2" placeholder="选择父分类">
   						      <div id="tree2" style="display: none; position:absolute; z-index:1010; background-color:white;"></div>
   						    </div>
   						  </div>
   						</form>
   					</div>
   					<div class="modal-footer">
   						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
   						<button type="button" class="btn btn-primary">编辑</button>
   					</div>
   				</div>
   			</div>
   		</div>
   		<!-- /.modal -->
   		
   		<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   			<div class="modal-dialog" role="document">
   				<div class="modal-content">
   					<div class="modal-header">
   						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
   						<h4 class="modal-title" id="myModalLabel">查看分类</h4>
   					</div>
   					<div class="modal-body">
   						<form class="form-horizontal">
   						  <div class="form-group">
   						    <label for="name" class="col-sm-3 control-label">分类名称</label>
   						    <div class="col-sm-9">
   						      <span id="name3"></span>
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <label for="firstChar" class="col-sm-3 control-label">父分类名称</label>
   						    <div class="col-sm-9">
   						      
   						    </div>
   						  </div>
   						</form>
   					</div>
   					<div class="modal-footer">
   						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
   					</div>
   				</div>
   			</div>
   		</div>
   		<!-- /.modal -->
   	</body>
   
   </html>
   ```

   

2. bootstrap-treeview树型插件

   参考：http://www.jq22.com/plugin/10461

   实例：

   ```
   <!--引入bootstrap-treeview.css和bootstrap-treeview.js-->
   <link rel="stylesheet" href="resource/css/bootstrap-treeview.css" />
   <script type="text/javascript" src="resource/bootstrap/js/bootstrap-treeview.js" ></script>
   ```

   ```
   <!--定位展示树型列表的区块-->
   <div id="tree" style="display: none; position:absolute; z-index:1010; background-color:white;"></div>
   ```

   ```
   <!--使用bootstrap-treeview插件加载静态数据并进行展示-->
   <script type="text/javascript">
   
     	$(function() {
           var defaultData = [
             {
               text: 'Parent 1',
               href: '#parent1',
               tags: ['4'],
               nodes: [
                 {
                   text: 'Child 1',
                   href: '#child1',
                   tags: ['2'],
                   nodes: [
                     {
                       text: 'Grandchild 1',
                       href: '#grandchild1',
                       tags: ['0']
                     },
                     {
                       text: 'Grandchild 2',
                       href: '#grandchild2',
                       tags: ['0']
                     }
                   ]
                 },
                 {
                   text: 'Child 2',
                   href: '#child2',
                   tags: ['0']
                 }
               ]
             },
             {
               text: 'Parent 2',
               href: '#parent2',
               tags: ['0']
             },
             {
               text: 'Parent 3',
               href: '#parent3',
                tags: ['0']
             },
             {
               text: 'Parent 4',
               href: '#parent4',
               tags: ['0']
             },
             {
               text: 'Parent 5',
               href: '#parent5'  ,
               tags: ['0']
             }
           ];
           
   		$("#parentName").click(function() {
   			$('#tree').treeview({
   	          	data: defaultData,
   		        onNodeSelected : function(event, data) {
   					$("#parentId").val(data.id);
   					$("#parentName").val(data.text);
   					$("#tree").hide();//选中树节点后隐藏树
   				}
   	        });	
   	        $('#tree').show();
   		});
   	});
   </script>
   ```

   

3. 项目引入页面-category_list.jsp

   ```
   <%@ page language="java" contentType="text/html; charset=UTF-8"
       pageEncoding="UTF-8"%>
   <%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
   <!DOCTYPE html>
   <html lang="zh-CN">
     <head>
     	<base href="${pageContext.request.contextPath }/">
       <meta charset="utf-8">
   		<meta http-equiv="X-UA-Compatible" content="IE=edge">
   		<meta name="viewport" content="width=device-width, initial-scale=1">
   		<title>分类管理</title>
   		<link href="resource/css/bootstrap.css" rel="stylesheet">
   		<link rel="stylesheet" href="resource/css/bootstrap-treeview.css" />
   		<script type="text/javascript" src="resource/jquery/jquery-3.4.1.js"></script>
   	  	<script type="text/javascript" src="resource/bootstrap/js/bootstrap.min.js"></script>
   	  	<script type="text/javascript" src="resource/bootstrap/js/bootstrap-treeview.js" ></script>
   		<script>
   		function addCategory(){
   			if($("#parentName").val()==''){
   				$("#parentId").val(0);
   			}
       		$.post('categoryAdd',$('#modalForm1').serialize(),function(data){
       			if(data){
       				$("#myModal").modal('hide');
       				window.location.reload();
       			}else{
       				alert('添加分类失败');
       			}
       		},'json');
       	}
       	function editCategory(){
       		if($("#parentName2").val()==''){
   				$("#parentId2").val(0);
   			}
       		$.post('categoryAdd',$('#modalForm2').serialize(),function(data){
       			if(data){
       				$("#myModal2").modal('hide');
       				window.location.reload();
       			}else{
       				alert('编辑分类失败');
       			}
       		},'json');
       	}
       	//修改模态框的数据回显和详情模态框的页面展示
       	function getCategoryById(id,flag){
       		$.post('getCategoryById',{id:id},function(data){
       			if(flag==1){
           			//修改模态框的数据回显
       				$('#id2').val(data.id);
           			$('#name2').val(data.text);
           			$('#parentId2').val(data.parentId);	
           			$('#parentName2').val(data.parentName);	
       			}else{
       				//详情模态框的页面展示
       				$('#name3').text(data.text);
           			$('#parentName3').text(data.parentName);	
       			}
       		},'json');
       	}
       	$(function(){
       		$("#parentName").click(function() {
       			$.post('getAllCategories', {}, function(data) {
       				var options = {
      						levels : 2,
      						data : data,
      						onNodeSelected : function(event, data) {
      							$("#parentId").val(data.id);
      							$("#parentName").val(data.text);
      							$("#tree").hide();//选中树节点后隐藏树
      						}
      					};
       				$('#tree').treeview(options);
   					$('#tree').show();
       			});
   			});
       		$("#parentName2").click(function() {
       			$.post('getAllCategories', {}, function(data) {
       				var options = {
      						levels : 2,
      						data : data,
      						onNodeSelected : function(event, data) {
      							$("#parentId2").val(data.id);
      							$("#parentName2").val(data.text);
      							$("#tree2").hide();//选中树节点后隐藏树
      						}
      					};
       				$('#tree2').treeview(options);
   					$('#tree2').show();
       			});
   			});
       	})
       	function deleteCategory(id){
      			if(confirm('确定要删除选中的数据吗?')){
      				$.post('categoryDelete',{id:id},function(data){
      	    			if(data.code==20010){
      	    				window.location.reload();
      	    			}else{
      	    				alert(data.code + "@" + data.msg);
      	    			}
      	    		},'json');
      			}
       	}
       </script>
   	</head>
   
   	<body>
   		<div class="container-fluid">
   			<div class="row">
   				<form action="categoryList" method="post">
   					<div class="form-group">
   						<label for="name">分类名称</label>
   						<input type="text" class="form-control" id="name" name="name" placeholder="分类名称" value="${category.name}">
   					</div>
   					<button type="submit" class="btn btn-success">搜索</button>
   				</form>
   			</div>
   			<div class="row navbar-right">
   				<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal">
   				  新增分类
   				</button>
   			</div>
   			<div class="row">
   				<table class="table table-striped">
   					<thead>
   						<tr>
   							<th>编号</th>
   							<th>分类名称</th>
   							<th>父分类名称</th>
   							<th>操作</th>
   						</tr>
   					</thead>
   					<tbody>
   						<c:forEach items="${pageInfo.list}" var="category" varStatus="index">
   						<tr>
   							<td>${index.count}</td>
   							<td>${category.name}</td>
   							<td>${category.parentName}</td>
   							<td>
   					          	<button class="btn btn-danger" onclick="deleteCategory(${category.id})">删除</button>
   					          	<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal2" onclick="getCategoryById(${category.id},1);">修改</button>
   								<button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#myModal3" onclick="getCategoryById(${category.id},2);">查看</button>
   					        </td>
   						</tr>
   						</c:forEach>
   					</tbody>
   				</table>
   				
   				<nav>
   				  <ul class="pagination">
   				  	<c:if test="${pageInfo.hasPreviousPage}">
   				    <li>
   				      <a href="categoryList?pageNum=${pageInfo.pageNum-1}&name=${category.name}">
   				        <span aria-hidden="true">上一页</span>
   				      </a>
   				    </li>
   				    </c:if>
   				    <!-- [1,2,3,4,5] -->
   				    <c:forEach items="${pageInfo.navigatepageNums}" var="pageNum">
   				    	<c:if test="${pageInfo.pageNum==pageNum}">
   				    	<li class="active"><a href="categoryList?pageNum=${pageNum}&name=${category.name}">${pageNum}</a></li>
   				    	</c:if>
   				    	<c:if test="${pageInfo.pageNum!=pageNum}">
   				    	<li><a href="categoryList?pageNum=${pageNum}&name=${category.name}">${pageNum}</a></li>
   				    	</c:if>
   				    </c:forEach>
   				    <c:if test="${pageInfo.hasNextPage}">
   				    <li>
   				      <a href="categoryList?pageNum=${pageInfo.pageNum+1}&name=${category.name}" aria-label="Next">
   				        <span aria-hidden="true">下一页</span>
   				      </a>
   				    </li>
   				    </c:if>
   				  </ul>
   				</nav>
   
   			</div>
   		</div>
   		<!-- 新增分类 -->
   		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   			<div class="modal-dialog" role="document">
   				<div class="modal-content">
   					<div class="modal-header">
   						<button type="button" class="close" data-dismiss="modal" aria-label="Close"  onclick="$('#tree').hide()"><span aria-hidden="true">&times;</span></button>
   						<h4 class="modal-title">新增分类</h4>
   					</div>
   					<div class="modal-body">
   						<form class="form-horizontal" id="modalForm1" action="javascript:void(0);">
   						  <div class="form-group">
   						    <label for="name" class="col-sm-3 control-label">分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="name" name="name" placeholder="分类名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <label for="firstChar" class="col-sm-3 control-label">父分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="hidden" class="form-control" id="parentId" name="parentId"> 
   							  <input type="text" class="form-control" id="parentName" name="parentName" placeholder="选择父分类">
   						      <div id="tree" style="display: none; position:absolute; z-index:1010; background-color:white;"></div>
   						    </div>
   						  </div>
   						</form>
   					</div>
   					<div class="modal-footer">
   						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="$('#tree').hide()">关闭</button>
   						<button type="button" class="btn btn-primary" onclick="addCategory()">添加</button>
   					</div>
   				</div>
   			</div>
   		</div>
   		<!-- /.modal -->
   
   
   
   		<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   			<div class="modal-dialog" role="document">
   				<div class="modal-content">
   					<div class="modal-header">
   						<button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#tree2').hide()"><span aria-hidden="true">&times;</span></button>
   						<h4 class="modal-title">编辑分类</h4>
   					</div>
   					<div class="modal-body">
   						<form class="form-horizontal" id="modalForm2" action="javascript:void(0);">
   						  <input type="hidden" id="id2" name="id">
   						  <div class="form-group">
   						    <label for="name" class="col-sm-3 control-label">分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="name2" name="name" placeholder="分类名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <label for="firstChar" class="col-sm-3 control-label">父分类名称</label>
   						    <div class="col-sm-9">
   						      <input type="hidden" class="form-control" id="parentId2" name="parentId"> 
   							  <input type="text" class="form-control" id="parentName2" name="parentName" placeholder="选择父分类">
   						      <div id="tree2" style="display: none; position:absolute; z-index:1010; background-color:white;"></div>
   						    </div>
   						  </div>
   						</form>
   					</div>
   					<div class="modal-footer">
   						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="$('#tree2').hide()">关闭</button>
   						<button type="button" class="btn btn-primary" onclick="editCategory()">编辑</button>
   					</div>
   				</div>
   			</div>
   		</div>
   		<!-- /.modal -->
   		
   		<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   			<div class="modal-dialog" role="document">
   				<div class="modal-content">
   					<div class="modal-header">
   						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
   						<h4 class="modal-title">查看分类</h4>
   					</div>
   					<div class="modal-body">
   						<form class="form-horizontal" id="modalForm3" action="javascript:void(0);">
   						  <div class="form-group">
   						    <label for="name" class="col-sm-3 control-label">分类名称</label>
   						    <div class="col-sm-9">
   						      <span id="name3"></span>
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <label for="firstChar" class="col-sm-3 control-label">父分类名称</label>
   						    <div class="col-sm-9">
   						      <span id="parentName3"></span>
   						    </div>
   						  </div>
   						</form>
   					</div>
   					<div class="modal-footer">
   						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
   					</div>
   				</div>
   			</div>
   		</div>
   		<!-- /.modal -->
   	</body>
   
   </html>
   ```

   

### 13.1.2 添加分类

1. 控制层-CategoryController

   ```
   /**
    * 分类添加或编辑页面显示tree
    * @return
    */
   @RequestMapping("/getAllCategories")
   @ResponseBody
   public List<Category> getAllCategories(){
   	return categoryService.getAllCategories();
   }
   ```

   ```
   /**
    * 添加或编辑分类
    * @param category
    * @return
    */
   @RequestMapping("/categoryAdd")
   @ResponseBody
   public boolean categoryAdd(Category category){
   	return categoryService.addCategory(category) > 0;
   }
   ```

   

2. 接口层-CategoryService

   ```
   List<Category> getAllCategories();
   Integer addCategory(Category category);
   ```

   

3. 服务层-CategoryServiceImpl

   ```
   @Override
   public List<Category> getAllCategories() {
   	return categoryMapper.selectAllCategories();
   }
   
   /**
    * 数据库中添加和修改分类
    */
   @Override
   public Integer addCategory(Category category) {
   	Integer count = null;
   	if (category.getId() == null) {
   		//新增
   		if (category.getParentId() == null) {
   			category.setParentId(0);
   		}
   		count = categoryMapper.insertCategory(category);
   	} else {
   		//修改
   		count = categoryMapper.updateCategory(category);
   	}
   		
   	return count;
   }
   ```

   

4. 数据访问层-CategoryMapper

   ```
   List<Category> selectAllCategories();
   
   Integer insertCategory(Category category);
   ```

   ```
   <resultMap type="category" id="categoryMap">
   	<id column="id" property="id"/>
   	<result column="name" property="name"/>
   	<collection property="childs" javaType="arrayList" ofType="Category">
   		<id column="c2_id" property="id"/>
   		<result column="c2_name" property="name"/>
   		<collection property="childs" javaType="arrayList" ofType="Category">
   			<id column="c3_id" property="id"/>
   			<result column="c3_name" property="name"/>
   		</collection>
   	</collection>
   </resultMap>
   <select id="selectAllCategories" resultMap="categoryMap">
   	select c1.id,c1.name,c2.id c2_id,c2.name c2_name,c3.id c3_id, c3.name c3_name from hg_category c1 left join hg_category c2 on c1.id=c2.parent_id left join hg_category c3 on c2.id=c3.parent_id where c1.parent_id=0
   </select>
   ```

   ```
   <insert id="insertCategory" useGeneratedKeys="true" keyProperty="id">
   	insert into hg_category(name,parent_id) values (#{name},#{parentId})
   </insert>
   ```

   

### 13.1.3 分类列表

1. 控制层-CategoryController

   ```
   /**
    * 分类分页列表
    * @param model
    * @param category
    * @param pageNum
    * @param pageSize
    * @return
    */
   @RequestMapping("/categoryList")
   public String categoryList(Model model, Category category, @RequestParam(defaultValue="1")Integer pageNum, @RequestParam(defaultValue="3")Integer pageSize) {
   	//1.获取数据
   	PageInfo<Category> pageInfo = categoryService.list(category, pageNum, pageSize);
   	//2.填充数据
   	model.addAttribute("pageInfo", pageInfo);
   	model.addAttribute("category", category);
   	return "category_list";
   }
   ```

   

2. 接口层-CategoryService

   ```
   PageInfo<Category> list(Category category, Integer pageNum, Integer pageSize);
   ```

   

3. 服务层-CategoryServiceImpl

   ```
   @Override
   public PageInfo<Category> list(Category category, Integer pageNum, Integer pageSize) {
   	PageHelper.startPage(pageNum, pageSize);
   	List<Category> list = categoryMapper.selectCategoryList(category);
   	PageInfo<Category> pageInfo = new PageInfo<Category>(list);
   	return pageInfo;
   }
   ```

   

4. 数据访问层-CategoryMapper

   ```
   List<Category> selectCategoryList(Category category);
   ```

   ```
   <select id="selectCategoryList" resultType="category">
   	select c1.id,c1.name,c2.name parentName from hg_category c1 left join hg_category c2 on c1.parent_id=c2.id
   	<where>
       	<if test="name!=null and name!=''">
   			and c1.name like concat('%',#{name},'%')
   		</if>
   	</where>
   </select>
   ```

   

### 13.1.4 修改分类

1. 控制层-CategoryController

   ```
   /**
    * 修改回显和详情
    * @param id
    * @return
    */
   @RequestMapping("/getCategoryById")
   @ResponseBody
   public Category getCategoryById(Integer id) {
   	return categoryService.getCategoryById(id);
   }
   ```

   ```
   /**
    * 添加或编辑分类
    * @param category
    * @return
    */
   @RequestMapping("/categoryAdd")
   @ResponseBody
   public boolean categoryAdd(Category category){
    return categoryService.addCategory(category) > 0;
   }
   ```

   

2. 接口层-CategoryService

   ```
   Category getCategoryById(Integer id);
   Integer addCategory(Category category);
   ```

   

3. 服务层-CategoryServiceImpl

   ```
   @Override
   public Category getCategoryById(Integer id) {
   	return categoryMapper.selectCategoryById(id);
   }
   	
   /**
    * 数据库中添加和修改分类
    */
   @Override
   public Integer addCategory(Category category) {
   	Integer count = null;
   	if (category.getId() == null) {
   		//新增
   		if (category.getParentId() == null) {
   			category.setParentId(0);
   		}
   		count = categoryMapper.insertCategory(category);
   	} else {
   		//修改
   		count = categoryMapper.updateCategory(category);
   	}
   	
   	return count;
   }
   ```

   

4. 数据访问层-CategoryMapper

   ```
   Category selectCategoryById(Integer id);
   
   Integer updateCategory(Category category);
   ```

   ```
   <select id="selectCategoryById" resultType="category">
   	select c1.id,c1.name,c1.parent_id,c2.name parentName from hg_category c1 left join hg_category c2 on c1.parent_id=c2.id where c1.id=#{id}
   </select>
   
   <update id="updateCategory">
   	update hg_category set name=#{name},parent_id=#{parentId} where id=#{id}
   </update>
   ```

   

### 13.1.5 删除分类

1. 控制层-CategoryController

   ```
   /**
   * 删除分类
   * @param id
   * @return
   */
   @RequestMapping("/categoryDelete")
   @ResponseBody
   public Map<String, String> categoryDelete(Integer id){
   	return categoryService.deleteCategory(id);
   }
   ```

   

2. 接口层-CategoryService

   ```
   Map<String, String> deleteCategory(Integer id);
   ```

   

3. 服务层-CategoryServiceImpl

   ```
   @Override
   public Map<String, String> deleteCategory(Integer id) {
   	Map<String, String> map = new HashMap<>();
   
       //1.判定当前分类节点是否有子分类。如果有，不能删除，提示有叶子节点
       Integer count = categoryMapper.getChildCategoryCount(id);
       if (count > 0) {
           map.put("code", "20011");
           map.put("msg", "该分类不是叶子节点");
   		return map;
   	}
   	//2.如果当前分类下没有子分类，将该分类下所有商品信息中category_id设置为null
   
       //3.删除该分类
       count = categoryMapper.deleteCategoryById(id);
       if (count > 0) {
           map.put("code", "20010");
           map.put("msg", "删除分类成功");
   	} else {
           map.put("code", "20012");
           map.put("msg", "删除分类失败");
   	}
   	return map;
   }
   ```

   

4. 数据访问层-CategoryMapper

   ```
   Integer getChildCategoryCount(Integer id);
   
   Integer deleteCategoryById(Integer id);
   ```

   ```
   <select id="getChildCategoryCount" resultType="int">
   	select count(0) from hg_category where parent_id=#{id}
   </select>
   
   <delete id="deleteCategoryById">
   	delete from hg_category where id=#{id}
   </delete>
   ```

   

## 13.2 规格参数管理

### 13.2.1 规格参数页面

1. 页面原型-spec_list.html

   ```
   <!DOCTYPE html>
   <html lang="zh-CN">
     <head>
       <meta charset="utf-8">
       <meta http-equiv="X-UA-Compatible" content="IE=edge">
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <title>hgshop后台管理系统</title>
   
   	<!-- Bootstrap core CSS -->
       <link href="resource/css/bootstrap.css" rel="stylesheet">
       <script type="text/javascript" src="resource/jquery/jquery-3.4.1.js"></script>
       <script type="text/javascript" src="resource/bootstrap/js/bootstrap.min.js"></script>
       
       
       <script>
       	//全局变量
   		  var index=0;
   		  //增加选项
   		  function addOption(){
   		   	//创建div的jquery对象
   			  var $div =$('<div class="form-group" data-option-id='+0+'><label class="col-sm-3 control-label">规格内容</label><div class="col-sm-6"><input type="text" class="form-control" name="options['+index+'].optionName" placeholder="请输入规格内容"></div><div class="col-sm-3"><input type="button" class="btn-danger" value="删除" onclick="deleteOption(this)"/></div></div>');
   			  //传递参数判断的操作
   			  //加入到指定的from表单中
   			  $("#addForm").append($div);
   			  //下标++
      			index++;
        	}
   		  
   		  function deleteOption(obj){
    	 	 		//$(obj)代表的把Dom对象转换成jquery对象: 通过找到加入的div的jquery对象,通过jquery中的parent()方法，再通过jquery对象中的remove()把自己删除
   	      var $div = $(obj).parent().parent();
   	      //自定属性的获取方式
   	      var optionId = $div.data().optionId;
   	      //判断获取的结果
   	      if(optionId==0){
   	    	  $div.remove();
   	       }else{
             $.post('specOptionDelete',{id:optionId},function(data){
           	  if(data){
                 alert("选项删除成功");
                 $div.remove();
               }else{
                 alert("选项删除失败");
               }
        		 	},"json")
          	}
    	 	 	}
       </script>
     </head>
     
     <body>
     	<div class="container-fluid">
     		<div class="row">
     			<form action="javascript:void(0)" method="post">
   				  <div class="form-group">
   				    <label for="specName">规格名称</label>
   				    <input type="text" class="form-control" id="specName" placeholder="规格名称">
   				  </div>
   				  <button class="btn btn-success">搜索</button>
   				</form>
     		</div>
     		
     		<div class="row" style="float: right;">
   				  <button class="btn btn-danger">批量删除</button>
   					<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal">
   				  	新增规格
   					</button>
     		</div>
     		
     		<div class="row">
     			<table class="table table-striped">
   		      <thead>
   		        <tr>
   		        	<th><input type="checkbox" id="cbk">全选</th>
   		          <th>编号</th>
   		          <th>规格名称</th>
   		          <th>规格选项</th>
   		          <th>操作</th>
   		        </tr>
   		      </thead>
   		      <tbody>
   		        <tr>
   		        	<td><input type="checkbox" class="ck"/></td>
   		          <td>1</td>
   		          <td>Mark</td>
   		          <td>Otto</td>
   		          <td>
   		          	<button class="btn btn-danger">删除</button>
   		          	<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal">
   								  修改
   								</button>
   								<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal">
   								  查看
   								</button>
   		          </td>
   		        </tr>
   		      </tbody>
   		    </table>
   		    
   		    <nav>
   				  <ul class="pagination">
   				    <li>
   				      <a href="#">
   				        <span aria-hidden="true">上一页</span>
   				      </a>
   				    </li>
   				    <li><a href="#">1</a></li>
   				    <li><a href="#">2</a></li>
   				    <li>
   				      <a href="#" aria-label="Next">
   				        <span aria-hidden="true">下一页</span>
   				      </a>
   				    </li>
   				  </ul>
   				</nav>
     		</div>
     	</div>
     
     
     	<!-- Modal -->
   		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   		  <div class="modal-dialog" role="document">
   		    <div class="modal-content">
   		      <div class="modal-header">
   		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
   		        <h4 class="modal-title" id="myModalLabel">新增规格参数</h4>
   		      </div>
   		      <div class="modal-body">
   		        <form class="form-horizontal" id="addForm">
   						  <div class="form-group">
   						    <label for="addSpecName" class="col-sm-3 control-label">规格名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="addSpecName" placeholder="规格名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <div class="col-sm-3">
   									<input type="button" class="btn btn-info" value="增加选项内容"
   										onclick="addOption()" />
   								</div>
   						  </div>
   						</form>
   		      </div>
   		      <div class="modal-footer">
   		        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
   		        <button type="button" class="btn btn-primary">添加</button>
   		      </div>
   		    </div>
   		  </div>
   		</div>
   
     </body>
   </html>
   ```

   

2. 项目引入页面-spec_list.jsp

   ```
   <%@ page language="java" contentType="text/html; charset=UTF-8"
       pageEncoding="UTF-8"%>
   <%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
   <!DOCTYPE html>
   <html lang="zh-CN">
     <head>
     	<base href="${pageContext.request.contextPath }/">
       <meta charset="utf-8">
       <meta http-equiv="X-UA-Compatible" content="IE=edge">
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <title>hgshop后台管理系统</title>
   
   	<!-- Bootstrap core CSS -->
       <link href="resource/css/bootstrap.css" rel="stylesheet">
       <script type="text/javascript" src="resource/jquery/jquery-3.4.1.js"></script>
       <script type="text/javascript" src="resource/bootstrap/js/bootstrap.min.js"></script>
       <script>
       	function preAddSpec(){
       		$('.add-option').remove();
       	}
       	var index=0; //【新增规格】时，规格选项递增的索引值
       	var index2=0; //【修改规格】时，规格选项递增的索引值
       	function addSpecOption(flag){
       		var obj1,obj2;
       		if(flag==1){
       			//新增模态框
       			obj1=$('#addForm');
       			obj2=index;
       		}else{
       			//修改模态框
       			obj1=$('#editForm');
       			obj2=index2;
       		}
       		
       		var str = '<div class="form-group add-option">'
       			+'<label class="col-sm-3 control-label">规格内容</label>'
       			+'<div class="col-sm-6">'
       			+'  <input type="text" class="form-control" name="options[' + obj2 + '].optionName"  placeholder="规格内容">'
       			+'</div>'
       			+'<div class="col-sm-3">'
       			+'<input type="button" class="btn-danger" value="删除" onclick="deleteOption(this)">'
       			+'</div>'
       			+'</div>';
       		obj1.append(str);
       		if(flag==1){
       			index++;
       		}else{
       			index2++;
       		}
       		
       		
       	}
       	function deleteOption(obj){
       		$(obj).parent().parent().remove();
       	}
       	function addSpec(flag){
   			var obj1,obj2;
   			if(flag==1){
   				//新增
   				obj1=$('#addForm');
   				obj2=$('#myModal');
   			}else{
   				obj1=$('#editForm');
   				obj2=$('#myModal2');
   			}
       		$.post('specAdd',obj1.serialize(),function(data){
       			if(data){
       				obj2.modal('hide');
       				window.location.reload();
       			}else{
       				alert('操作规格失败!');
       			}
       		});
       	}
       	function getSpecById(id){
       		$('.add-option').remove();
       		$.post('getSpecById',{id:id},function(data){
       			$('#id2').val(data.id);
       			$('#specName2').val(data.specName);
       			for(var i in data.options){
       				var str = '<div class="form-group add-option">'
       	    			+'<label for="specName1" class="col-sm-3 control-label">规格内容</label>'
       	    			+'<div class="col-sm-6">'
       	    			+'  <input type="text" class="form-control" name="options[' + index2 + '].optionName" value="' + data.options[i].optionName + '"  placeholder="规格内容">'
       	    			+'</div>'
       	    			+'<div class="col-sm-3">'
       	    			+'<input type="button" class="btn-danger" value="删除" onclick="deleteOption(this)">'
       	    			+'</div>'
       	    			+'</div>';
       	    		$('#editForm').append(str);
       	    		index2++;
       			}
       		});	
       	}
       	function view(id){
       		$('.add-option').remove();
       		$.post('getSpecById',{id:id},function(data){
       			$('#specName3').text(data.specName);
       			for(var i in data.options){
       				var str = '<div class="form-group add-option">'
       	    			+'<label for="specName1" class="col-sm-3 control-label">规格内容</label>'
       	    			+'<div class="col-sm-9">'
       	    			+'<span>' + data.options[i].optionName + '</span>'
       	    			+'</div>'
       	    			+'</div>';
       	    		$('#viewForm').append(str);
       			}
       		});	
       	}
       	$(function(){
       		$('#cbk').on('click',function(){
       			$('.ck').prop('checked', this.checked);
       		});
       	})
       	function deleteSpec(ids){
       		if(ids==undefined){
       			//批量删除 [user1,user2,user3]  ----> [1,2,3]
       			ids = $('.ck:checked').map(function(){
       				return this.value;
       			}).get().join(',');
       		}
       		if(ids!=''){
       			if(confirm('确定要删除选中的数据吗?')){
       				$.post('specDelete',{ids:ids},function(data){
       	    			if(data){
       	    				window.location.reload();
       	    			}else{
       	    				alert('删除规格失败');
       	    			}
       	    		},'json');
       			}
       		}else{
       			alert('请选中要删除的数据');
       		}
       	}
       </script>
   	</head>
     <body>
     	<div class="container-fluid">
     		<div class="row">
     			<form action="specList" method="post">
   				  <div class="form-group">
   				    <label for="specName">规格名称</label>
   				    <input type="text" class="form-control" id="specName" name="specName" placeholder="规格名称" value="${spec.specName}">
   				  </div>
   				  <button class="btn btn-success" type="submit">搜索</button>
   				</form>
     		</div>
     		
     		<div class="row" style="float: right;">
   				  <button class="btn btn-danger" onclick="deleteSpec()">批量删除</button>
   					<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal" onclick="preAddSpec()">
   				  	新增规格
   					</button>
     		</div>
     		
     		<div class="row">
     			<table class="table table-striped">
   		      <thead>
   		        <tr>
   		        	<th><input type="checkbox" id="cbk">全选</th>
   		          <th>编号</th>
   		          <th>规格名称</th>
   		          <th>规格选项</th>
   		          <th>操作</th>
   		        </tr>
   		      </thead>
   		      <tbody>
   		      	<c:forEach items="${pageInfo.list}" var="spec" varStatus="index">
   		        <tr>
   		        	<td><input type="checkbox" class="ck" value="${spec.id}"/></td>
   		          <td>${index.count }</td>
   		          <td>${spec.specName }</td>
   		          <td>
   		          		${spec.optionNames}
   		          </td>
   		          <td>
   		          	<button class="btn btn-danger" onclick="deleteSpec(${spec.id})">删除</button>
   		          	<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal2" onclick="getSpecById(${spec.id})">
   								  修改
   								</button>
   								<button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal3" onclick="view(${spec.id})">
   								  查看
   								</button>
   		          </td>
   		        </tr>
   		        </c:forEach>
   		      </tbody>
   		    </table>
   		    
   		    <nav>
   				  <ul class="pagination">
   				  	<c:if test="${pageInfo.hasPreviousPage}">
   				    <li>
   				      <a href="specList?pageNum=${pageInfo.prePage}&specName=${spec.specName}">
   				        <span aria-hidden="true">上一页</span>
   				      </a>
   				    </li>
   				    </c:if>
   				    <c:forEach items="${pageInfo.navigatepageNums}" var="pageNum">
   				    	<c:if test="${pageInfo.pageNum==pageNum}">
   				    	<li class="active"><a href="specList?pageNum=${pageNum}&specName=${spec.specName}">${pageNum}</a></li>
   				    	</c:if>
   				    	<c:if test="${pageInfo.pageNum!=pageNum}">
   				    	<li><a href="specList?pageNum=${pageNum}&specName=${spec.specName}">${pageNum}</a></li>
   				    	</c:if>
   				    </c:forEach>
   				    <c:if test="${pageInfo.hasNextPage}">
   				    <li>
   				      <a href="specList?pageNum=${pageInfo.nextPage}&specName=${spec.specName}" aria-label="Next">
   				        <span aria-hidden="true">下一页</span>
   				      </a>
   				    </li>
   				    </c:if>
   				  </ul>
   				</nav>
     		</div>
     	</div>
     
     
     		<!-- Modal -->
   		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   		  <div class="modal-dialog" role="document">
   		    <div class="modal-content">
   		      <div class="modal-header">
   		        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="preAddSpec(1)"><span aria-hidden="true">&times;</span></button>
   		        <h4 class="modal-title" id="myModalLabel">新增规格参数</h4>
   		      </div>
   		      <div class="modal-body">
   		        <form class="form-horizontal" id="addForm" method="post">
   						  <div class="form-group">
   						    <label for="specName1" class="col-sm-3 control-label">规格名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="specName1" name="specName" placeholder="规格名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <div class="col-sm-3">
   									<input type="button" class="btn btn-info" value="增加选项内容" id="addOption"
   										onclick="addSpecOption(1)" />
   								</div>
   						  </div>
   						</form>
   		      </div>
   		      <div class="modal-footer">
   		        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="preAddSpec(1)">关闭</button>
   		        <button type="button" class="btn btn-primary" onclick="addSpec(1)">添加</button>
   		      </div>
   		    </div>
   		  </div>
   		</div>
   
   
   		<!-- Modal -->
   		<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   		  <div class="modal-dialog" role="document">
   		    <div class="modal-content">
   		      <div class="modal-header">
   		        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="preAddSpec(2)"><span aria-hidden="true">&times;</span></button>
   		        <h4 class="modal-title" id="myModalLabel">编辑规格参数</h4>
   		      </div>
   		      <div class="modal-body">
   		        <form class="form-horizontal" id="editForm">
   		        	<input type="hidden" id="id2" name="id"/>
   						  <div class="form-group">
   						    <label for="specName2" class="col-sm-3 control-label">规格名称</label>
   						    <div class="col-sm-9">
   						      <input type="text" class="form-control" id="specName2" name="specName" placeholder="规格名称">
   						    </div>
   						  </div>
   						  <div class="form-group">
   						    <div class="col-sm-3">
   									<input type="button" class="btn btn-info" value="增加选项内容" id="addOption"
   										onclick="addSpecOption(2)" />
   								</div>
   						  </div>
   						</form>
   		      </div>
   		      <div class="modal-footer">
   		        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="preAddSpec(2)">关闭</button>
   		        <button type="button" class="btn btn-primary" onclick="addSpec(2)">添加</button>
   		      </div>
   		    </div>
   		  </div>
   		</div>
   		
   		<!-- Modal -->
   		<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
   		  <div class="modal-dialog" role="document">
   		    <div class="modal-content">
   		      <div class="modal-header">
   		        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="preAddSpec(2)"><span aria-hidden="true">&times;</span></button>
   		        <h4 class="modal-title" id="myModalLabel">查看规格参数</h4>
   		      </div>
   		      <div class="modal-body">
   		        <form class="form-horizontal" id="viewForm">
   						  <div class="form-group">
   						    <label for="specName3" class="col-sm-3 control-label">规格名称</label>
   						    <div class="col-sm-9">
   						      <span id="specName3"></span>
   						    </div>
   						  </div>
   						</form>
   		      </div>
   		      <div class="modal-footer">
   		        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
   		      </div>
   		    </div>
   		  </div>
   		</div>
     </body>
   </html>
   ```

   

### 13.2.2 添加规格及选项

1. 控制层-SpecController

   ```
   @RequestMapping("/specAdd")
   @ResponseBody
   public boolean specAdd(Spec spec){
   	return specService.saveOrUpdateSpec(spec) > 0;
   }
   ```

   

2. 接口层-SpecService

   ```
   Integer saveOrUpdateSpec(Spec spec);
   ```

   

3. 服务层-SpecServiceImpl

   ```
   @Override
   public Integer saveOrUpdateSpec(Spec spec) {
   	Integer count = null;
   	if (spec.getId() == null) {
   		//1.新增
   		//1.1.插入hg_spec
   		count = specMapper.insertSpec(spec);
   	} else {
   		//2.修改
   		//2.1.修改hg_spec
   		count = specMapper.updateSpec(spec);
   		//2.2.删除对应的hg_spec_option所有的记录
   		specMapper.deleteSpecOptionBySpecId(spec.getId());
   	}
   	//3.批量插入hg_spec_option
   	for (SpecOption specOption : spec.getOptions()) {
   		if (StringUtils.isNotBlank(specOption.getOptionName())) {
   			specOption.setSpecId(spec.getId());
   			specMapper.insertSpecOption(specOption);
   		}
   	}
   	return count;
   }
   ```

   

4. 数据访问层-SpecMapper

   ```
   Integer insertSpec(Spec spec);
   
   void insertSpecOption(SpecOption specOption);
   ```

   ```
   <insert id="insertSpec" useGeneratedKeys="true" keyProperty="id">
   	insert into hg_spec(spec_name) values (#{specName})
   </insert>
   
   <insert id="insertSpecOption">
   	insert into hg_spec_option(option_name, spec_id) values (#{optionName},#{specId})
   </insert>
   ```

   

### 13.2.3 规格参数列表

1. 控制层-SpecController

   ```
   @RequestMapping("/specList")
   public String list(Model model, Spec spec, @RequestParam(defaultValue="1")Integer pageNum, @RequestParam(defaultValue="2")Integer pageSize) {
   	PageInfo<Spec> pageInfo = specService.list(spec, pageNum, pageSize);
   	model.addAttribute("spec", spec);
   	model.addAttribute("pageInfo", pageInfo);
   	return "spec_list";
   }
   ```

   

2. 接口层-SpecService

   ```
   PageInfo<Spec> list(Spec spec, Integer pageNum, Integer pageSize);
   ```

   

3. 服务层-SpecServiceImpl

   ```
   @Override
   public PageInfo<Spec> list(Spec spec, Integer pageNum, Integer pageSize) {
   	PageHelper.startPage(pageNum, pageSize);
   	List<Spec> list = specMapper.selectSpecList(spec);
   	PageInfo<Spec> pageInfo = new PageInfo<>(list);
   	return pageInfo;
   }
   ```

   

4. 数据访问层-SpecMapper

   ```
   List<Spec> selectSpecList(Spec spec);
   ```

   ```
   <select id="selectSpecList" resultType="spec">
   	select s.id,s.spec_name,group_concat(so.option_name) optionNames
   	from hg_spec s left join hg_spec_option so
   	on s.id=so.spec_id
   	<where>
   		<if test="specName!=null and specName!=''">
   			and s.spec_name like concat('%',#{specName},'%')
   		</if>
   	</where>
   	group by s.id
   </select>
   ```

   